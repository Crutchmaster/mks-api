# Microservices API (0.0.1-draft)

## Что это? / WTF?

API для обмена информацией между микросервисами. Тут описан формат входящих/исходящих сообщений в виде json, 
название очередей rabbit mq и прочее.

Условые обозначения
```
... - и т.д.
<агрументы> - ссылка
```


## Версия

```
(x.y.z-s)
x - Номер ветки. Векти несовместимы между собой
y - Совместимая версия в рамках ветки x
z - Номер версии. Увеличивать с каждой правкой.
s : draft - черновик, rc - кандидат в релизы, релиз - без суфикса
```

## Название микросервиса

Такое же, как название команды, но не должно содержать суффикс потока

## Суффиксы потока

```
"_in" - очередь входящих сообщений
"_out" - очередь исходящих сообщение
"_err" - очередь для ошибок/диагностики
```



## Входнящие сообщения

### Команда
```
{"command" : "<название команды>", "args" : <аргументы>}
```

### Название команды

Допускаются латинские буквы любых регистров, цифры, символ `_`. Первый символ - буква.

### Агрументы

#### Без агрументов
```
[]
```
#### Несколько агрументов
```
["arg1","arg2",...]
```
#### Массив как агрумент
```
["arg1",["arg2.1","arg2.2",..."],...]
```

## Исходящие сообщения
### Для потока ошибок (_err)
#### Ошибка
```
{"error":"message"}
```
#### Сообщение
```
{"info":"message"}
```
#### Предупреждение
```
{"warn":"message"}
```

### Для исходящего потока (_out)

Произвольный валидный json

## Стандартные команды

### Аргументы
```
string - строка
float - число с плав.точкой
int - целое
[string|float|int] - массив
В ответе
argn - аргумент n
в остальных случаях - описание
```
### Тестовые команды
|Команда |Агрументы |Ответ в out |
|---|---|---|
|ping|нет|{"pong" : "ok"}|
|test|string|{"test" : ["arg1"]}|
|test2|string,string|{"test2" : ["arg1","arg2"]}|
|test3|int,float,string|{"test3" : ["arg1","arg2","true, если arg3=='true' иначе false"]}|
|test4|[int]|{"test4" : "массив arg1 разделённый ','"}

### Установка очереди
```
Команды: setInputQueue, setErrorQueue, setOutputQueue
Агрументы: string - название очереди
Эффект: переназначают входящую очередь, очедерь ошибок и исходящую очередь соотвественно
Ответ: {"название исходящей команды":"arg1", "result":"ok"}
```

### Список команд микросервиса
```
Команда: getCommands
Агрументы: нет
Ответ: {"commands" : ["command1","command2",...]}
```

### Название приложения
```
Команда: getName
Агрументы: нет
{"appName" : "Название микросервиса"}
```
